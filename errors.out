++ pwd
+ ROOT_DIR=/Users/keith/src/floppytool
+ TEST_DIR=/Users/keith/src/floppytool/tests
+ BIN=/Users/keith/src/floppytool/target/release/floppytool
+ TEMP_DIR=/Users/keith/src/floppytool/tests/temp
+ SIZE_360k=368640
+ cargo build --release
    Finished `release` profile [optimized] target(s) in 0.01s
+ mkdir -p /Users/keith/src/floppytool/tests/temp
+ cd /Users/keith/src/floppytool/tests/temp
+ test_conversion 360k 40,2,9,512,4
+ local size=360k
+ local geometry=40,2,9,512,4
+ local imd=/Users/keith/src/floppytool/tests/360k/360k.imd
+ local img=/Users/keith/src/floppytool/tests/360k/360k.img
+ local out_img=/Users/keith/src/floppytool/tests/temp/360k_out.img
+ local out_imd=/Users/keith/src/floppytool/tests/temp/360k_out.imd
+ local meta=/Users/keith/src/floppytool/tests/360k/360k.imd.meta
+ local expected_size
+ case "$size" in
+ expected_size=368640
+ echo 'Testing 360k...'
Testing 360k...
+ rm -f /Users/keith/src/floppytool/tests/temp/360k_out.img /Users/keith/src/floppytool/tests/temp/360k_out.imd /Users/keith/src/floppytool/tests/360k/360k.imd.meta
+ echo '  .imd -> .img'
  .imd -> .img
+ /Users/keith/src/floppytool/target/release/floppytool --input /Users/keith/src/floppytool/tests/360k/360k.imd convert --format img --output /Users/keith/src/floppytool/tests/temp/360k_out.img --verbose --validate
Processing Cyl 0, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 0, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 1, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 1, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 2, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 2, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 3, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 3, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 4, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 4, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 5, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 5, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 6, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 6, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 7, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 7, Head 1: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Processing Cyl 8, Head 0: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 8, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 9, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 9, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 10, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 10, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 11, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 11, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 12, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 12, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 13, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 13, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 14, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 14, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 15, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 15, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 16, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 16, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 17, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Processing Cyl 17, Head 1: 9 sectors (3 normal, 6 compressed), size 512 bytes, mode 4
Processing Cyl 18, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 18, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 19, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 19, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 20, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 20, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 21, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 21, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 22, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 22, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 23, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 23, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 24, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 24, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 25, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 25, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 26, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 26, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 27, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 27, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 28, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 28, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 29, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 29, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 30, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 30, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 31, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 31, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 32, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 32, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 33, Head 0: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Processing Cyl 33, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 34, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 34, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 35, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 35, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 36, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 36, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 37, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Processing Cyl 37, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 38, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 38, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 39, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 39, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Total sectors: 720, Compressed sectors: 104
Saved metadata to /Users/keith/src/floppytool/tests/360k/360k.imd.meta
Validation passed: Output size matches expected geometry
Geometry for reverse conversion: 40,2,9,512,4
Warning: Output size 368640 differs from input size 317378 due to compression in source .imd
Validation passed: Output size matches expected geometry
Converted to /Users/keith/src/floppytool/tests/temp/360k_out.img
+ '[' -f /Users/keith/src/floppytool/tests/temp/360k_out.img ']'
++ wc -c
++ tr -d ' '
+ actual_size=368640
+ '[' 368640 -eq 368640 ']'
+ cmp /Users/keith/src/floppytool/tests/360k/360k.img /Users/keith/src/floppytool/tests/temp/360k_out.img
+ echo '    OK: Matches reference .img'
    OK: Matches reference .img
+ '[' -f /Users/keith/src/floppytool/tests/360k/360k.imd.meta ']'
+ echo '  .img -> .imd (no meta)'
  .img -> .imd (no meta)
+ /Users/keith/src/floppytool/target/release/floppytool --input /Users/keith/src/floppytool/tests/360k/360k.img convert --format imd --output /Users/keith/src/floppytool/tests/temp/360k_out.imd --geometry 40,2,9,512,4 --verbose --validate
Loaded metadata from /Users/keith/src/floppytool/tests/360k/360k.imd.meta
Writing Cyl 0, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 0, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 1, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 1, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 2, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 2, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 3, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 3, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 4, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 4, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 5, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 5, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 6, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 6, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 7, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 7, Head 1: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Writing Cyl 8, Head 0: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 8, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 9, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 9, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 10, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 10, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 11, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 11, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 12, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 12, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 13, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 13, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 14, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 14, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 15, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 15, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 16, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 16, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 17, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Writing Cyl 17, Head 1: 9 sectors (3 normal, 6 compressed), size 512 bytes, mode 4
Writing Cyl 18, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 18, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 19, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 19, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 20, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 20, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 21, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 21, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 22, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 22, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 23, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 23, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 24, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 24, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 25, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 25, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 26, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 26, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 27, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 27, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 28, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 28, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 29, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 29, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 30, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 30, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 31, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 31, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 32, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 32, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 33, Head 0: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Writing Cyl 33, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 34, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 34, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 35, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 35, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 36, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 36, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 37, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Writing Cyl 37, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 38, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 38, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 39, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 39, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Total sectors: 720, Compressed sectors: 104
Validation passed: Output matches written data
Warning: Output size 317378 differs from input size 368640 due to compression in output .imd
Validation passed: IMD file written successfully
Converted to /Users/keith/src/floppytool/tests/temp/360k_out.imd
+ '[' -f /Users/keith/src/floppytool/tests/temp/360k_out.imd ']'
+ echo '  Roundtrip: .imd -> .img -> .imd'
  Roundtrip: .imd -> .img -> .imd
+ /Users/keith/src/floppytool/target/release/floppytool --input /Users/keith/src/floppytool/tests/360k/360k.imd convert --format img --output /Users/keith/src/floppytool/tests/temp/360k_out.img --verbose --validate
Processing Cyl 0, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 0, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 1, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 1, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 2, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 2, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 3, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 3, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 4, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 4, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 5, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 5, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 6, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 6, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 7, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 7, Head 1: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Processing Cyl 8, Head 0: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Processing Cyl 8, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 9, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 9, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 10, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 10, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 11, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 11, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 12, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 12, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 13, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 13, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 14, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 14, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 15, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 15, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 16, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 16, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 17, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Processing Cyl 17, Head 1: 9 sectors (3 normal, 6 compressed), size 512 bytes, mode 4
Processing Cyl 18, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 18, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 19, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 19, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 20, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 20, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 21, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 21, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 22, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 22, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 23, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 23, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 24, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 24, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 25, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 25, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 26, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 26, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 27, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 27, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 28, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 28, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 29, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 29, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 30, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 30, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 31, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 31, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 32, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 32, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 33, Head 0: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Processing Cyl 33, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 34, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 34, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Processing Cyl 35, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Processing Cyl 35, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 36, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 36, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Processing Cyl 37, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Processing Cyl 37, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 38, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 38, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 39, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Processing Cyl 39, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Total sectors: 720, Compressed sectors: 104
Saved metadata to /Users/keith/src/floppytool/tests/360k/360k.imd.meta
Validation passed: Output size matches expected geometry
Geometry for reverse conversion: 40,2,9,512,4
Warning: Output size 368640 differs from input size 317378 due to compression in source .imd
Validation passed: Output size matches expected geometry
Converted to /Users/keith/src/floppytool/tests/temp/360k_out.img
+ /Users/keith/src/floppytool/target/release/floppytool --input /Users/keith/src/floppytool/tests/temp/360k_out.img convert --format imd --output /Users/keith/src/floppytool/tests/temp/360k_out.imd --geometry 40,2,9,512,4 --imdmeta /Users/keith/src/floppytool/tests/360k/360k.imd.meta --verbose --validate
Loaded metadata from /Users/keith/src/floppytool/tests/360k/360k.imd.meta
Writing Cyl 0, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 0, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 1, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 1, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 2, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 2, Head 1: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 3, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 3, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 4, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 4, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 5, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 5, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 6, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 6, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 7, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 7, Head 1: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Writing Cyl 8, Head 0: 9 sectors (6 normal, 3 compressed), size 512 bytes, mode 4
Writing Cyl 8, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 9, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 9, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 10, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 10, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 11, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 11, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 12, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 12, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 13, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 13, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 14, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 14, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 15, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 15, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 16, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 16, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 17, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Writing Cyl 17, Head 1: 9 sectors (3 normal, 6 compressed), size 512 bytes, mode 4
Writing Cyl 18, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 18, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 19, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 19, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 20, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 20, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 21, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 21, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 22, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 22, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 23, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 23, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 24, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 24, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 25, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 25, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 26, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 26, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 27, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 27, Head 1: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 28, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 28, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 29, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 29, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 30, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 30, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 31, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 31, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 32, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 32, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 33, Head 0: 9 sectors (5 normal, 4 compressed), size 512 bytes, mode 4
Writing Cyl 33, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 34, Head 0: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 34, Head 1: 9 sectors (9 normal, 0 compressed), size 512 bytes, mode 4
Writing Cyl 35, Head 0: 9 sectors (8 normal, 1 compressed), size 512 bytes, mode 4
Writing Cyl 35, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 36, Head 0: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 36, Head 1: 9 sectors (7 normal, 2 compressed), size 512 bytes, mode 4
Writing Cyl 37, Head 0: 9 sectors (4 normal, 5 compressed), size 512 bytes, mode 4
Writing Cyl 37, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 38, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 38, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 39, Head 0: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Writing Cyl 39, Head 1: 9 sectors (0 normal, 9 compressed), size 512 bytes, mode 4
Total sectors: 720, Compressed sectors: 104
Validation passed: Output matches written data
Warning: Output size 317378 differs from input size 368640 due to compression in output .imd
Validation passed: IMD file written successfully
Converted to /Users/keith/src/floppytool/tests/temp/360k_out.imd
+ cmp /Users/keith/src/floppytool/tests/360k/360k.imd /Users/keith/src/floppytool/tests/temp/360k_out.imd
+ echo '    OK: Roundtrip matches original'
    OK: Roundtrip matches original
+ echo 'Cleaning up...'
Cleaning up...
+ rm -rf /Users/keith/src/floppytool/tests/temp
+ echo 'All tests completed successfully!'
All tests completed successfully!
